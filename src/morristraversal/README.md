## Morris 中序遍历

### 特点

函数的递归调用，递归深度等于二叉树的高度
如果二叉树的高度很大，例如搜索引擎把几十亿张网页按照权重来组成二叉树的话，那么二叉树的高度也有几十万，按照传统的遍历方式，需要消耗大量的内存。
Morris遍历法，能以**O(1)的空间复杂度**实现二叉树的遍历。

### Morris 中续遍历

中续遍历过程中，如果一个结点有前驱结点，那么**前驱结点的右指针**只有两种情况
- 是空的
- 是这个结点本身（即前驱是它的父结点）
Morris中续遍历法就是把前驱结点的右指针利用起来，来降低遍历所需的空间复杂度。

于是我们多做一步：让当前节点的前序节点（左子树中最右边的节点）的右指针指向它，这样在左子树遍历完成后我们通过这个指向走回根节点；
走回的同时也表示着我们已经完成了左子树的遍历，不用再通过栈来维护，省去了栈的空间。

如何查找一个节点的前序节点呢？
- 当前节点没有左孩子： 
    - 它是其父节点的右孩子，那么它的前序节点就是它的父节点
    - 它是父节点的左孩子，那么它没有前序节点，自己就是首节点
- 如果该节点有左孩子，从左孩子开始，沿着其右孩子指针一直向右到底，得到的节点就是它的前序节点（前序节点的右指针一定是空的）

Morris遍历算法的步骤如下：
1，找到当前节点前序节点，如果前序节点的右孩子是空，那么把前序节点的右孩子指向当前节点，然后进入当前节点的左孩子。
2，如果当前节点的左孩子为空，打印当前节点，然后进入右孩子。
3，如果当前节点前序节点的右孩子指向了它，那么把前序节点的右孩子设置为空，打印当前节点，然后进入右孩子。

### 复杂度分析
在遍历过程中，每个节点最多会被访问两次，一次是从父节点到当前节点，第二次是从前序节点的右孩子指针返回当前节点，所以Morris遍历算法的时间复杂度是O(n)。
在遍历过程中，没有申请新内存，因此算法的空间复杂度是O(1).

Morris遍历，由于要把前缀节点的右指针指向自己，所以暂时会改变二叉树的结构。
但在从前缀节点返回到自身时，算法会把前缀节点的右指针重新设置为空，所以二叉树在结构改变后，又会更改回来。

一个Morris中序遍历的java实现：
```
    public void morrisTraversal(TreeNode node) {
        while (node != null) {
            if (node.left == null) { // 完成了左子树的遍历
                // 则打印当前节点，然后进入右孩子。
                System.out.print(node.val);
                node = node.right;
            } else { // 未完成左子树的遍历
                TreeNode pre = getPredecessor(node); // 查找当前节点的前序节点
                if (pre.right == null) { //前序节点的右孩子是空
                    // 则把前序节点的右孩子指向当前节点 进入当前节点的左孩子
                    pre.right = node;
                    node = node.left;
                } else if (pre.right == node) { //前序节点的右孩子指向了它
                    // 则把前序节点的右孩子设置为空，打印当前节点，然后进入右孩子
                    pre.right = null;
                    System.out.print(node.val);
                    node = node.right;
                }
            }
        }
    }

    private TreeNode getPredecessor(TreeNode node) {
        TreeNode pre = node;
        if (node.left != null) {
            pre = pre.left;
            while (pre.right != null && pre.right != node) {
                pre = pre.right;
            }
        }
        return pre;
    }
```
