散列 哈希 hash

# 定义

将任意长度的二进制串映射为固定长度的二进制串。

- 从哈希值不能反向推导出原始数据（因此哈希算法也称为单项哈希算法）
- 对输入数据非常敏感，原始数据修改一个bit，哈希值也会大不相同
- 散列冲突的概率要很小
- 执行效率要尽量高，对于很长的文本，也能快速计算出哈希值

MD5的哈希值128位

# 应用

## 1.安全加密

MD5 Message-Digest Algorithm 消息摘要算法 
SHA Secure Hash Algorithm 安全散列算法 
对于加密用途 不能反向推导和冲突的概率小 是最重要的特性

因为哈希值的长度是固定的（有限的），因此必然无法做到零冲突。一般情况下哈希值越长散列冲突概率越低。 
毫无规律的穷举寻找相同哈希值的数据是非常困难的，所以即便存在冲突有限的时间和资源下，哈希算法还是很难破解的。 
没有绝对安全，越复杂、越难破解的加密算法，需要的计算时间越长。比如SHA-256比SHA-1安全，破解的时间要长很多。

## 2.唯一标示

任何文件在计算机中都可以被标示为二进制码串。 
eg.取开头100B 中间100B 末尾100B ，放在一起计算哈希作为唯一标示。

## 3.数据校验

校验文件的完整、安全、正确。 
应对不稳定的网络传输等情况。

### 在区块链中的应用

区块链是一块块区块组成的，每个区块分为两部分：区块头和区块体。 
区块头保存着 自己区块体 和 上一个区块头 的哈希值。 
因为这种链式关系和哈希值的唯一性，只要区块链上任意一个区块被修改过，后面所有区块保存的哈希值就不对。 
区块链使用的是 SHA256 哈希算法，计算哈希值非常耗时，如果要篡改一个区块，就必须重新计算该区块后面所有的区块的哈希值，短时间内几乎不可能做到。

## 4.散列函数

散列函数也是哈希算法的一种应用。对算法的要求相对低很多，追求简单/效率。 
散列函数更关系散列值是否更平均

## 5.负载均衡

负载均衡算法很多，比如轮询、随机、加权随机等。当我们需要做到回话粘滞Session sticky，即同一个客户端在一次会话时的所有请求都路由到同一个服务器上。可以用维护映射关系表的方法实现，但是效率不高，问题很多。 
借助哈希算法可以完美解决。通过对会话ID或者客户端IP计算哈希值，将哈希值与服务器数量取模，最终得到的值就是应该被路由到的服务器编号。

## 6.数据切片

处理超大数据时，首先占用空间很大一台机器的内存可能不够，其次处理时间也会很长。针对这个问题可以先对数据进行切片来提高处理速度。 
使用n台设备并行处理，首先遍历数据，对每条数据的关键字取哈希值然后再和n取模，得到的值就是应该分配到的机器编号。这样保证同一个关键词都被分配到一台机器上。

查询数据是否在一个很大的库中，单机构建散列表空间不够。同样使用多机处理，每一台机器仅维护某一部分数据对应的散列表，通过哈希取模先分配应到的机器，再从机器的散列表中查找。

## 7.分布式存储

同样是解决哪个数据放在哪个机器上的问题。 
这里有一个扩容可能导致的问题，当扩容后，原来取模的值就变化了，所有的数据都需要重新计算哈希值然后重新搬运到新的机器上。如果是分布式缓存，相当于所有缓存失效，发生雪崩效应，压垮数据库。 
需要一种算法在扩容后不需要做大量的数据迁移，即使用**一致性哈希算法**consistent hashing/dht 解决分布式存储结构下动态增加和删除节点带来的问题。 
假设有k台机器，数据的哈希范围是[0,MAX], 将整个范围划分为m个小区间（m非常大，redis使用2的14次方），每个机器/缓存结点Shard负责m/k个区间的数据，当有新机器加入的时候，已有一部分区间会受影响，只需要将相关区间的数据搬运到新的机器中。 这样既不用全部重新哈希搬运，也保持了机器上数据的均衡。 


## 其他应用

网络协议CRC校验 git commit id